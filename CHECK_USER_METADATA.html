<!DOCTYPE html>
<html>
<head>
    <title>Check User Metadata</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Check User Metadata</h1>
    <button onclick="checkUser()">Check Current User Metadata</button>
    <pre id="output"></pre>

    <script>
        const projectId = "cddoboboxeangripcqrn";
        const publicAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNkZG9ib2JveGVhbmdyaXBjcXJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3NTgyNTQsImV4cCI6MjA3NTMzNDI1NH0.JS5pdOsT8xocAIA9uPYnWsoE0FwChKJ1jfOIObJRpEo";

        const supabase = window.supabase.createClient(
            `https://${projectId}.supabase.co`,
            publicAnonKey
        );

        async function checkUser() {
            const output = document.getElementById('output');

            try {
                const { data: { session }, error } = await supabase.auth.getSession();

                if (error) {
                    output.textContent = 'Error: ' + error.message;
                    return;
                }

                if (!session) {
                    output.textContent = 'No user logged in. Please log in to your app first.';
                    return;
                }

                const user = session.user;

                output.textContent = JSON.stringify({
                    user_id: user.id,
                    email: user.email,
                    role: user.user_metadata?.role,
                    business_id: user.user_metadata?.business_id,
                    business_name: user.user_metadata?.business_name,
                    full_metadata: user.user_metadata
                }, null, 2);

                // Check if business_id is missing
                if (!user.user_metadata?.business_id) {
                    output.textContent += '\n\n⚠️ WARNING: business_id is MISSING from user metadata!\n';
                    output.textContent += 'This is why workers cannot be created.\n';
                    output.textContent += 'The user needs to have business_id set in their metadata.';
                }
            } catch (err) {
                output.textContent = 'Error: ' + err.message;
            }
        }
    </script>
</body>
</html>
